FASE1_TERMINADO$DIAS_LICENCIA[FASE1_TERMINADO$DIAS_LICENCIA<0]<-0
FASE1_TERMINADO$FIN_LICENCIA_F1<-ymd(Sys.Date()) + (FASE1_TERMINADO$DIAS_LICENCIA)
#SIMULACION DE TERMINACIÓN FASE 2
PROYECTOS_FASE2<-as.data.frame(DATOS[DATOS$ESTADO.ACTUAL.F1=="Terminado",])
PROYECTOS_FASE2$FIN_LICENCIA_F1<-PROYECTOS_FASE2$FECHA.FIN.F1
PROMEDIOS_HITOS<-(PROYECTOS_FASE2[c("PLAZO.ETAPA.1.F2","PLAZO.ETAPA.2.F2","PLAZO.ETAPA.3.F2","PLAZO.ETAPA.4.F2","PLAZO.ETAPA.5.F2")])
PROMEDIOS_HITOS<-PROMEDIOS_HITOS[!is.na(PROMEDIOS_HITOS$PLAZO.ETAPA.1.F2),]
PROMEDIOS_HITOS$MAX<-apply(PROMEDIOS_HITOS,1, max)
PROMEDIOS_HITOS<-PROMEDIOS_HITOS/PROMEDIOS_HITOS$MAX
HITO1<-0
PROMEDIO<-as.data.frame(HITO1)
PROMEDIO$HITO1<-mean(PROMEDIOS_HITOS$PLAZO.ETAPA.1.F2, na.rm = T)
PROMEDIO$HITO2<-mean(PROMEDIOS_HITOS$PLAZO.ETAPA.2.F2, na.rm = T)
PROMEDIO$HITO3<-mean(PROMEDIOS_HITOS$PLAZO.ETAPA.3.F2, na.rm = T)
PROMEDIO$HITO4<-mean(PROMEDIOS_HITOS$PLAZO.ETAPA.4.F2, na.rm = T)
PROMEDIO$HITO5<-mean(PROMEDIOS_HITOS$PLAZO.ETAPA.5.F2, na.rm = T)
PROYECTOS_LICENCIA<-rbind(PROYECTOS_FASE1,FASE1_TERMINADO)
PROYECTOS_SIN_PLAZO<-PROYECTOS_FASE2[PROYECTOS_FASE2$PLAZO.ETAPA.1.F2==0,]
PROYECTOS_SIN_PLAZO<-PROYECTOS_SIN_PLAZO[!is.na(PROYECTOS_SIN_PLAZO$PLAZO.ETAPA.1.F2),]
PROYECTOS_LICENCIA<-subset(PROYECTOS_LICENCIA,select = -c(DIAS_FALTANTES, INTERVALO,P,INVERSA, BETA,PORC_FASE1, DIAS_SIMULADOS, FIN_FASE1, RND_LICENCIA, DIAS_LICENCIA))
PROYECTOS_LICENCIA_FASE1<-rbind(PROYECTOS_LICENCIA,PROYECTOS_SIN_PLAZO)
#PROYECTOS_FASE1_TERMINADOS<-subset(PROYECTOS_LICENCIA_FASE1,select = -c(DIAS_FALTANTES, INTERVALO,P,INVERSA, BETA,PORC_FASE1, DIAS_SIMULADOS, FIN_FASE1, RND_LICENCIA, DIAS_LICENCIA))
PROYECTOS_FASE1_TERMINADOS<-PROYECTOS_LICENCIA_FASE1
PROYECTOS_FASE1_TERMINADOS$PLAZO.ETAPA.1.F2<-PROYECTOS_FASE1_TERMINADOS$PLAZO.FASE.OBRA..F2.*PROMEDIO$HITO1*30
PROYECTOS_FASE1_TERMINADOS$PLAZO.ETAPA.2.F2<-PROYECTOS_FASE1_TERMINADOS$PLAZO.FASE.OBRA..F2.*PROMEDIO$HITO2*30
PROYECTOS_FASE1_TERMINADOS$PLAZO.ETAPA.3.F2<-PROYECTOS_FASE1_TERMINADOS$PLAZO.FASE.OBRA..F2.*PROMEDIO$HITO3*30
PROYECTOS_FASE1_TERMINADOS$PLAZO.ETAPA.4.F2<-PROYECTOS_FASE1_TERMINADOS$PLAZO.FASE.OBRA..F2.*PROMEDIO$HITO4*30
PROYECTOS_FASE1_TERMINADOS$PLAZO.ETAPA.5.F2<-PROYECTOS_FASE1_TERMINADOS$PLAZO.FASE.OBRA..F2.*PROMEDIO$HITO5*30
PROYECTOS_FASE2<-PROYECTOS_FASE2[PROYECTOS_FASE2$PLAZO.ETAPA.1.F2!=0,]
FASE2_SIMULACION<-rbind(PROYECTOS_FASE2, PROYECTOS_FASE1_TERMINADOS)
FASE2_SIMULACION$PAGO_F2_HITO1<-FASE2_SIMULACION$PAGO.ETAPA.1.F2*0.8
FASE2_SIMULACION$PAGO_F2_HITO2<-FASE2_SIMULACION$PAGO.ETAPA.2.F2*0.8
FASE2_SIMULACION$PAGO_F2_HITO3<-FASE2_SIMULACION$PAGO.ETAPA.3.F2*0.8
FASE2_SIMULACION$PAGO_F2_HITO4<-FASE2_SIMULACION$PAGO.ETAPA.4.F2*0.8
FASE2_SIMULACION$PAGO_F2_HITO5<-FASE2_SIMULACION$PAGO.ETAPA.5.F2*0.8
# FASE2_SIMULACION$PLAZO.ETAPA.1.F2[is.na(FASE2_SIMULACION$PLAZO.ETAPA.1.F2)]<-0
# FASE2_SIMULACION$PLAZO.ETAPA.2.F2[is.na(FASE2_SIMULACION$PLAZO.ETAPA.2.F2)]<-0
# FASE2_SIMULACION$PLAZO.ETAPA.3.F2[is.na(FASE2_SIMULACION$PLAZO.ETAPA.3.F2)]<-0
# FASE2_SIMULACION$PLAZO.ETAPA.4.F2[is.na(FASE2_SIMULACION$PLAZO.ETAPA.4.F2)]<-0
# FASE2_SIMULACION$PLAZO.ETAPA.5.F2[is.na(FASE2_SIMULACION$PLAZO.ETAPA.5.F2)]<-0
FASE2_SIMULACION$DIAS_FIN_HITO1<-ceiling((1-FASE2_SIMULACION$AVANCE.F2.ETAPA.1)*(1+sample(BD$PORCENTAJE_DURACION,size=nrow(FASE2_SIMULACION),replace=TRUE))*FASE2_SIMULACION$PLAZO.ETAPA.1.F2)
FASE2_SIMULACION$DIAS_FIN_HITO2<-ceiling((1-FASE2_SIMULACION$AVANCE.F2.ETAPA.2)*(1+sample(BD$PORCENTAJE_DURACION,size=nrow(FASE2_SIMULACION),replace=TRUE))*FASE2_SIMULACION$PLAZO.ETAPA.2.F2)
FASE2_SIMULACION$DIAS_FIN_HITO3<-ceiling((1-FASE2_SIMULACION$AVANCE.F2.ETAPA.3)*(1+sample(BD$PORCENTAJE_DURACION,size=nrow(FASE2_SIMULACION),replace=TRUE))*FASE2_SIMULACION$PLAZO.ETAPA.3.F2)
FASE2_SIMULACION$DIAS_FIN_HITO4<-ceiling((1-FASE2_SIMULACION$AVANCE.F2.ETAPA.4)*(1+sample(BD$PORCENTAJE_DURACION,size=nrow(FASE2_SIMULACION),replace=TRUE))*FASE2_SIMULACION$PLAZO.ETAPA.4.F2)
FASE2_SIMULACION$DIAS_FIN_HITO5<-ceiling((1-FASE2_SIMULACION$AVANCE.F2.ETAPA.5)*(1+sample(BD$PORCENTAJE_DURACION,size=nrow(FASE2_SIMULACION),replace=TRUE))*FASE2_SIMULACION$PLAZO.ETAPA.5.F2)
FASE2_SIMULACION$FIN_LICENCIA_F1[FASE2_SIMULACION$FIN_LICENCIA_F1<Sys.Date()]<-ymd(Sys.Date())
FASE2_SIMULACION$FECHA_FIN_HITO1<-FASE2_SIMULACION$FIN_LICENCIA_F1+ FASE2_SIMULACION$DIAS_FIN_HITO1
FASE2_SIMULACION$FECHA_FIN_HITO2<-FASE2_SIMULACION$FECHA_FIN_HITO1+ FASE2_SIMULACION$DIAS_FIN_HITO2
FASE2_SIMULACION$FECHA_FIN_HITO3<-FASE2_SIMULACION$FECHA_FIN_HITO2+ FASE2_SIMULACION$DIAS_FIN_HITO3
FASE2_SIMULACION$FECHA_FIN_HITO4<-FASE2_SIMULACION$FECHA_FIN_HITO3+ FASE2_SIMULACION$DIAS_FIN_HITO4
FASE2_SIMULACION$FECHA_FIN_HITO5<-FASE2_SIMULACION$FECHA_FIN_HITO4+ FASE2_SIMULACION$DIAS_FIN_HITO5
FASE2_SIMULACION$VALOR.INICIAL.F1[FASE2_SIMULACION$ESTADO.ACTUAL.F1=="Terminado"]<-0
FASE2_SIMULACION$PAGO_F2_HITO1[FASE2_SIMULACION$AVANCE.F2.ETAPA.1==1]<-0
FASE2_SIMULACION$PAGO_F2_HITO2[FASE2_SIMULACION$AVANCE.F2.ETAPA.2==1]<-0
FASE2_SIMULACION$PAGO_F2_HITO3[FASE2_SIMULACION$AVANCE.F2.ETAPA.3==1]<-0
FASE2_SIMULACION$PAGO_F2_HITO4[FASE2_SIMULACION$AVANCE.F2.ETAPA.4==1]<-0
FASE2_SIMULACION$PAGO_F2_HITO5[FASE2_SIMULACION$AVANCE.F2.ETAPA.5==1]<-0
FASE2_SIMULACION$PAGO_F2_HITO1[FASE2_SIMULACION$ESTADO.ACTUAL.F2=="Abandonado"]<-0
FASE2_SIMULACION$PAGO_F2_HITO2[FASE2_SIMULACION$ESTADO.ACTUAL.F2=="Abandonado"]<-0
FASE2_SIMULACION$PAGO_F2_HITO3[FASE2_SIMULACION$ESTADO.ACTUAL.F2=="Abandonado"]<-0
FASE2_SIMULACION$PAGO_F2_HITO4[FASE2_SIMULACION$ESTADO.ACTUAL.F2=="Abandonado"]<-0
FASE2_SIMULACION$PAGO_F2_HITO5[FASE2_SIMULACION$ESTADO.ACTUAL.F2=="Abandonado"]<-0
FASE2_SIMULACION$PAGO_F2_HITO1[FASE2_SIMULACION$ESTADO.ACTUAL.F2=="Suspendido"]<-0
FASE2_SIMULACION$PAGO_F2_HITO2[FASE2_SIMULACION$ESTADO.ACTUAL.F2=="Suspendido"]<-0
FASE2_SIMULACION$PAGO_F2_HITO3[FASE2_SIMULACION$ESTADO.ACTUAL.F2=="Suspendido"]<-0
FASE2_SIMULACION$PAGO_F2_HITO4[FASE2_SIMULACION$ESTADO.ACTUAL.F2=="Suspendido"]<-0
FASE2_SIMULACION$PAGO_F2_HITO5[FASE2_SIMULACION$ESTADO.ACTUAL.F2=="Suspendido"]<-0
FASE2_SIMULACION$CORRIDA<-paste("Corrida",i)
FASE2_SIMULACION<-FASE2_SIMULACION[c("ACUERDO.DE.OBRA","INSTITUCIÓN.EDUCATIVA","DEPARTAMENTO","CIUDAD","FIN_LICENCIA_F1","VALOR.INICIAL.F1","FECHA_FIN_HITO1","PAGO_F2_HITO1","FECHA_FIN_HITO2","PAGO_F2_HITO2","FECHA_FIN_HITO3","PAGO_F2_HITO3","FECHA_FIN_HITO4","PAGO_F2_HITO4","FECHA_FIN_HITO5","PAGO_F2_HITO5", "CORRIDA")]
FASE2_TERMINADO<-rbind(FASE2_TERMINADO,FASE2_SIMULACION)
}
DATOS_SIMULACION<-FASE2_TERMINADO %>% gather(VALOR,FECHA_PAGO, c(FIN_LICENCIA_F1,FECHA_FIN_HITO1,FECHA_FIN_HITO2,FECHA_FIN_HITO3,FECHA_FIN_HITO4,FECHA_FIN_HITO5))
DATOS_SIMULACION<-DATOS_SIMULACION %>% gather(PAGO, VALOR_PAGADO, c(VALOR.INICIAL.F1,PAGO_F2_HITO1,PAGO_F2_HITO2,PAGO_F2_HITO3,PAGO_F2_HITO4,PAGO_F2_HITO5))
PRUEBA1<-DATOS_SIMULACION[c(DATOS_SIMULACION$VALOR=="FIN_LICENCIA_F1" & DATOS_SIMULACION$PAGO=="VALOR.INICIAL.F1"),]
PRUEBA2<-DATOS_SIMULACION[c(DATOS_SIMULACION$VALOR=="FECHA_FIN_HITO1" & DATOS_SIMULACION$PAGO=="PAGO_F2_HITO1"),]
PRUEBA3<-DATOS_SIMULACION[c(DATOS_SIMULACION$VALOR=="FECHA_FIN_HITO2" & DATOS_SIMULACION$PAGO=="PAGO_F2_HITO2"),]
PRUEBA4<-DATOS_SIMULACION[c(DATOS_SIMULACION$VALOR=="FECHA_FIN_HITO3" & DATOS_SIMULACION$PAGO=="PAGO_F2_HITO3"),]
PRUEBA5<-DATOS_SIMULACION[c(DATOS_SIMULACION$VALOR=="FECHA_FIN_HITO4" & DATOS_SIMULACION$PAGO=="PAGO_F2_HITO4"),]
PRUEBA6<-DATOS_SIMULACION[c(DATOS_SIMULACION$VALOR=="FECHA_FIN_HITO5" & DATOS_SIMULACION$PAGO=="PAGO_F2_HITO5"),]
DATOS_SIMULACION<-rbind(PRUEBA1,PRUEBA2,PRUEBA3,PRUEBA4,PRUEBA5,PRUEBA6)
DATOS_SIMULACION<-DATOS_SIMULACION[DATOS_SIMULACION$FECHA_PAGO>ymd('2019-01-01'),]
DATOS_SIMULACION<-DATOS_SIMULACION[!is.na(DATOS_SIMULACION$FECHA_PAGO),]
DATOS_SIMULACION$FECHA_NORM<-paste(year(DATOS_SIMULACION$FECHA_PAGO),"-",month(DATOS_SIMULACION$FECHA_PAGO),"-",1)
DATOS_SIMULACION$FECHA_NORM<-as.Date(DATOS_SIMULACION$FECHA_NORM, format="%Y - %m - %d") %m+% months(1)
SIMULACION_FFIE<-aggregate(VALOR_PAGADO~ACUERDO.DE.OBRA+INSTITUCIÓN.EDUCATIVA+CORRIDA+FECHA_NORM+VALOR, data=DATOS_SIMULACION, FUN="sum")
SIMULACION_FFIE$VALOR_PAGADO_PROMEDIO<-SIMULACION_FFIE$VALOR_PAGADO/Corridas
write.csv(DATOS_SIMULACION, file = "SIMULACION_FFIE.csv")
write.csv(DATOS_SIMULACION, file = "SIMULACION_FFIE.csv")
#MODELO DE SIMULACIÓN -----------------------------
BD <- read.csv("DATOS_GERINT_DEPU.csv", header = TRUE, sep = ",")
Escenarios<-1000
Corridas<- 100
FASE2_TERMINADO<-data.frame(ACUERDO.DE.OBRA=integer(),
INSTITUCIÓN.EDUCATIVA=factor(),
DEPARTAMENTO=factor(),
CIUDAD=factor(),
CORRIDA=character(),
FIN_LICENCIA_F1=as.Date(character()),
VALOR.INICIAL.F1=numeric(),
FECHA_FIN_HITO1=as.Date(character()),
PAGO_F2_HITO1=numeric(),
FECHA_FIN_HITO2=as.Date(character()),
PAGO_F2_HITO2=numeric(),
FECHA_FIN_HITO3=as.Date(character()),
PAGO_F2_HITO3=numeric(),
FECHA_FIN_HITO4=as.Date(character()),
PAGO_F2_HITO4=numeric(),
FECHA_FIN_HITO5=as.Date(character()),
PAGO_F2_HITO5=numeric())
for (i in 1:Corridas) {
set.seed(i)
#SIMULACIÓN DE TERMINACIÓN FASE 1
PROYECTOS_FASE1<-as.data.frame(DATOS[DATOS$ESTADO.ACTUAL.F1!="Terminado",])
PROYECTOS_FASE1<-as.data.frame(PROYECTOS_FASE1[!is.na(PROYECTOS_FASE1$ACUERDO.DE.OBRA),])
PROYECTOS_FASE1<-as.data.frame(PROYECTOS_FASE1[PROYECTOS_FASE1$AVANCE.FASE.1>0,])
PROYECTOS_FASE1<-as.data.frame(PROYECTOS_FASE1[PROYECTOS_FASE1$AVANCE.FASE.1<1,])
PROYECTOS_FASE1$DIAS_FALTANTES<-(PROYECTOS_FASE1$PLAZO.FASE.1*(1-PROYECTOS_FASE1$AVANCE.FASE.1))*30
PROYECTOS_FASE1$INTERVALO=interval(ymd(PROYECTOS_FASE1$FECHA.INICIO.F1),ymd(Sys.Date()))
PROYECTOS_FASE1$P<-(PROYECTOS_FASE1$INTERVALO %/% months(1)/PROYECTOS_FASE1$PLAZO.FASE.1)
PROYECTOS_FASE1$INVERSA<-pnorm(PROYECTOS_FASE1$P,mean = 4.2091667, sd = 0.8483226)
PROYECTOS_FASE1$BETA<-runif(nrow(PROYECTOS_FASE1),min = PROYECTOS_FASE1$INVERSA, max=1)
PROYECTOS_FASE1$PORC_FASE1<-qnorm(PROYECTOS_FASE1$BETA,mean = 4.2091667, sd = 0.8483226)
PROYECTOS_FASE1$DIAS_SIMULADOS<-PROYECTOS_FASE1$PORC_FASE1*PROYECTOS_FASE1$DIAS_FALTANTES
PROYECTOS_FASE1$FIN_FASE1<-ymd(Sys.Date()) + (PROYECTOS_FASE1$DIAS_SIMULADOS)
PROYECTOS_FASE1$RND_LICENCIA<-runif(nrow(PROYECTOS_FASE1))
PROYECTOS_FASE1$DIAS_LICENCIA<-qweibull(PROYECTOS_FASE1$RND_LICENCIA,shape = 1.278237, scale = 110.013093)-176
PROYECTOS_FASE1$DIAS_LICENCIA[PROYECTOS_FASE1$DIAS_LICENCIA<0]<-0
PROYECTOS_FASE1$FIN_LICENCIA_F1<-ymd(PROYECTOS_FASE1$FIN_FASE1) + (PROYECTOS_FASE1$DIAS_LICENCIA)
#SIMULACIÓN DE PEDIDO DE LICENCIA FASE 1
FASE1_TERMINADO<-as.data.frame(DATOS[DATOS$ESTADO.ACTUAL.F1!="Terminado",])
FASE1_TERMINADO<-as.data.frame(FASE1_TERMINADO[!is.na(FASE1_TERMINADO$ACUERDO.DE.OBRA),])
FASE1_TERMINADO<-as.data.frame(FASE1_TERMINADO[FASE1_TERMINADO$AVANCE.FASE.1==1,])
FASE1_TERMINADO$DIAS_FALTANTES<-0
FASE1_TERMINADO$INTERVALO<-interval(ymd(FASE1_TERMINADO$FECHA.INICIO.F1),ymd(Sys.Date()))
FASE1_TERMINADO$P<-(FASE1_TERMINADO$INTERVALO %/% months(1)/FASE1_TERMINADO$PLAZO.FASE.1)
FASE1_TERMINADO$INVERSA<-pnorm(FASE1_TERMINADO$P,mean = 4.2091667, sd = 0.8483226)
FASE1_TERMINADO$BETA<-0
FASE1_TERMINADO$PORC_FASE1<-0
FASE1_TERMINADO$DIAS_SIMULADOS<-0
FASE1_TERMINADO$FIN_FASE1<-FASE1_TERMINADO$FECHA.FIN.F1
FASE1_TERMINADO$RND_LICENCIA<-runif(nrow(FASE1_TERMINADO))
FASE1_TERMINADO$DIAS_LICENCIA<-qweibull(FASE1_TERMINADO$RND_LICENCIA,shape = 1.278237, scale = 110.013093)-176
FASE1_TERMINADO$DIAS_LICENCIA[FASE1_TERMINADO$DIAS_LICENCIA<0]<-0
FASE1_TERMINADO$FIN_LICENCIA_F1<-ymd(Sys.Date()) + (FASE1_TERMINADO$DIAS_LICENCIA)
#SIMULACION DE TERMINACIÓN FASE 2
PROYECTOS_FASE2<-as.data.frame(DATOS[DATOS$ESTADO.ACTUAL.F1=="Terminado",])
PROYECTOS_FASE2$FIN_LICENCIA_F1<-PROYECTOS_FASE2$FECHA.FIN.F1
PROMEDIOS_HITOS<-(PROYECTOS_FASE2[c("PLAZO.ETAPA.1.F2","PLAZO.ETAPA.2.F2","PLAZO.ETAPA.3.F2","PLAZO.ETAPA.4.F2","PLAZO.ETAPA.5.F2")])
PROMEDIOS_HITOS<-PROMEDIOS_HITOS[!is.na(PROMEDIOS_HITOS$PLAZO.ETAPA.1.F2),]
PROMEDIOS_HITOS$MAX<-apply(PROMEDIOS_HITOS,1, max)
PROMEDIOS_HITOS<-PROMEDIOS_HITOS/PROMEDIOS_HITOS$MAX
HITO1<-0
PROMEDIO<-as.data.frame(HITO1)
PROMEDIO$HITO1<-mean(PROMEDIOS_HITOS$PLAZO.ETAPA.1.F2, na.rm = T)
PROMEDIO$HITO2<-mean(PROMEDIOS_HITOS$PLAZO.ETAPA.2.F2, na.rm = T)
PROMEDIO$HITO3<-mean(PROMEDIOS_HITOS$PLAZO.ETAPA.3.F2, na.rm = T)
PROMEDIO$HITO4<-mean(PROMEDIOS_HITOS$PLAZO.ETAPA.4.F2, na.rm = T)
PROMEDIO$HITO5<-mean(PROMEDIOS_HITOS$PLAZO.ETAPA.5.F2, na.rm = T)
PROYECTOS_LICENCIA<-rbind(PROYECTOS_FASE1,FASE1_TERMINADO)
PROYECTOS_SIN_PLAZO<-PROYECTOS_FASE2[PROYECTOS_FASE2$PLAZO.ETAPA.1.F2==0,]
PROYECTOS_SIN_PLAZO<-PROYECTOS_SIN_PLAZO[!is.na(PROYECTOS_SIN_PLAZO$PLAZO.ETAPA.1.F2),]
PROYECTOS_LICENCIA<-subset(PROYECTOS_LICENCIA,select = -c(DIAS_FALTANTES, INTERVALO,P,INVERSA, BETA,PORC_FASE1, DIAS_SIMULADOS, FIN_FASE1, RND_LICENCIA, DIAS_LICENCIA))
PROYECTOS_LICENCIA_FASE1<-rbind(PROYECTOS_LICENCIA,PROYECTOS_SIN_PLAZO)
#PROYECTOS_FASE1_TERMINADOS<-subset(PROYECTOS_LICENCIA_FASE1,select = -c(DIAS_FALTANTES, INTERVALO,P,INVERSA, BETA,PORC_FASE1, DIAS_SIMULADOS, FIN_FASE1, RND_LICENCIA, DIAS_LICENCIA))
PROYECTOS_FASE1_TERMINADOS<-PROYECTOS_LICENCIA_FASE1
PROYECTOS_FASE1_TERMINADOS$PLAZO.ETAPA.1.F2<-PROYECTOS_FASE1_TERMINADOS$PLAZO.FASE.OBRA..F2.*PROMEDIO$HITO1*30
PROYECTOS_FASE1_TERMINADOS$PLAZO.ETAPA.2.F2<-PROYECTOS_FASE1_TERMINADOS$PLAZO.FASE.OBRA..F2.*PROMEDIO$HITO2*30
PROYECTOS_FASE1_TERMINADOS$PLAZO.ETAPA.3.F2<-PROYECTOS_FASE1_TERMINADOS$PLAZO.FASE.OBRA..F2.*PROMEDIO$HITO3*30
PROYECTOS_FASE1_TERMINADOS$PLAZO.ETAPA.4.F2<-PROYECTOS_FASE1_TERMINADOS$PLAZO.FASE.OBRA..F2.*PROMEDIO$HITO4*30
PROYECTOS_FASE1_TERMINADOS$PLAZO.ETAPA.5.F2<-PROYECTOS_FASE1_TERMINADOS$PLAZO.FASE.OBRA..F2.*PROMEDIO$HITO5*30
PROYECTOS_FASE2<-PROYECTOS_FASE2[PROYECTOS_FASE2$PLAZO.ETAPA.1.F2!=0,]
FASE2_SIMULACION<-rbind(PROYECTOS_FASE2, PROYECTOS_FASE1_TERMINADOS)
FASE2_SIMULACION$PAGO_F2_HITO1<-FASE2_SIMULACION$PAGO.ETAPA.1.F2*0.8
FASE2_SIMULACION$PAGO_F2_HITO2<-FASE2_SIMULACION$PAGO.ETAPA.2.F2*0.8
FASE2_SIMULACION$PAGO_F2_HITO3<-FASE2_SIMULACION$PAGO.ETAPA.3.F2*0.8
FASE2_SIMULACION$PAGO_F2_HITO4<-FASE2_SIMULACION$PAGO.ETAPA.4.F2*0.8
FASE2_SIMULACION$PAGO_F2_HITO5<-FASE2_SIMULACION$PAGO.ETAPA.5.F2*0.8
# FASE2_SIMULACION$PLAZO.ETAPA.1.F2[is.na(FASE2_SIMULACION$PLAZO.ETAPA.1.F2)]<-0
# FASE2_SIMULACION$PLAZO.ETAPA.2.F2[is.na(FASE2_SIMULACION$PLAZO.ETAPA.2.F2)]<-0
# FASE2_SIMULACION$PLAZO.ETAPA.3.F2[is.na(FASE2_SIMULACION$PLAZO.ETAPA.3.F2)]<-0
# FASE2_SIMULACION$PLAZO.ETAPA.4.F2[is.na(FASE2_SIMULACION$PLAZO.ETAPA.4.F2)]<-0
# FASE2_SIMULACION$PLAZO.ETAPA.5.F2[is.na(FASE2_SIMULACION$PLAZO.ETAPA.5.F2)]<-0
FASE2_SIMULACION$DIAS_FIN_HITO1<-ceiling((1-FASE2_SIMULACION$AVANCE.F2.ETAPA.1)*(1+sample(BD$PORCENTAJE_DURACION,size=nrow(FASE2_SIMULACION),replace=TRUE))*FASE2_SIMULACION$PLAZO.ETAPA.1.F2)
FASE2_SIMULACION$DIAS_FIN_HITO2<-ceiling((1-FASE2_SIMULACION$AVANCE.F2.ETAPA.2)*(1+sample(BD$PORCENTAJE_DURACION,size=nrow(FASE2_SIMULACION),replace=TRUE))*FASE2_SIMULACION$PLAZO.ETAPA.2.F2)
FASE2_SIMULACION$DIAS_FIN_HITO3<-ceiling((1-FASE2_SIMULACION$AVANCE.F2.ETAPA.3)*(1+sample(BD$PORCENTAJE_DURACION,size=nrow(FASE2_SIMULACION),replace=TRUE))*FASE2_SIMULACION$PLAZO.ETAPA.3.F2)
FASE2_SIMULACION$DIAS_FIN_HITO4<-ceiling((1-FASE2_SIMULACION$AVANCE.F2.ETAPA.4)*(1+sample(BD$PORCENTAJE_DURACION,size=nrow(FASE2_SIMULACION),replace=TRUE))*FASE2_SIMULACION$PLAZO.ETAPA.4.F2)
FASE2_SIMULACION$DIAS_FIN_HITO5<-ceiling((1-FASE2_SIMULACION$AVANCE.F2.ETAPA.5)*(1+sample(BD$PORCENTAJE_DURACION,size=nrow(FASE2_SIMULACION),replace=TRUE))*FASE2_SIMULACION$PLAZO.ETAPA.5.F2)
FASE2_SIMULACION$FIN_LICENCIA_F1[FASE2_SIMULACION$FIN_LICENCIA_F1<Sys.Date()]<-ymd(Sys.Date())
FASE2_SIMULACION$FECHA_FIN_HITO1<-FASE2_SIMULACION$FIN_LICENCIA_F1+ FASE2_SIMULACION$DIAS_FIN_HITO1
FASE2_SIMULACION$FECHA_FIN_HITO2<-FASE2_SIMULACION$FECHA_FIN_HITO1+ FASE2_SIMULACION$DIAS_FIN_HITO2
FASE2_SIMULACION$FECHA_FIN_HITO3<-FASE2_SIMULACION$FECHA_FIN_HITO2+ FASE2_SIMULACION$DIAS_FIN_HITO3
FASE2_SIMULACION$FECHA_FIN_HITO4<-FASE2_SIMULACION$FECHA_FIN_HITO3+ FASE2_SIMULACION$DIAS_FIN_HITO4
FASE2_SIMULACION$FECHA_FIN_HITO5<-FASE2_SIMULACION$FECHA_FIN_HITO4+ FASE2_SIMULACION$DIAS_FIN_HITO5
FASE2_SIMULACION$VALOR.INICIAL.F1[FASE2_SIMULACION$ESTADO.ACTUAL.F1=="Terminado"]<-0
FASE2_SIMULACION$PAGO_F2_HITO1[FASE2_SIMULACION$AVANCE.F2.ETAPA.1==1]<-0
FASE2_SIMULACION$PAGO_F2_HITO2[FASE2_SIMULACION$AVANCE.F2.ETAPA.2==1]<-0
FASE2_SIMULACION$PAGO_F2_HITO3[FASE2_SIMULACION$AVANCE.F2.ETAPA.3==1]<-0
FASE2_SIMULACION$PAGO_F2_HITO4[FASE2_SIMULACION$AVANCE.F2.ETAPA.4==1]<-0
FASE2_SIMULACION$PAGO_F2_HITO5[FASE2_SIMULACION$AVANCE.F2.ETAPA.5==1]<-0
# FASE2_SIMULACION$PAGO_F2_HITO1[FASE2_SIMULACION$ESTADO.ACTUAL.F2=="Abandonado"]<-0
# FASE2_SIMULACION$PAGO_F2_HITO2[FASE2_SIMULACION$ESTADO.ACTUAL.F2=="Abandonado"]<-0
# FASE2_SIMULACION$PAGO_F2_HITO3[FASE2_SIMULACION$ESTADO.ACTUAL.F2=="Abandonado"]<-0
# FASE2_SIMULACION$PAGO_F2_HITO4[FASE2_SIMULACION$ESTADO.ACTUAL.F2=="Abandonado"]<-0
# FASE2_SIMULACION$PAGO_F2_HITO5[FASE2_SIMULACION$ESTADO.ACTUAL.F2=="Abandonado"]<-0
# FASE2_SIMULACION$PAGO_F2_HITO1[FASE2_SIMULACION$ESTADO.ACTUAL.F2=="Suspendido"]<-0
# FASE2_SIMULACION$PAGO_F2_HITO2[FASE2_SIMULACION$ESTADO.ACTUAL.F2=="Suspendido"]<-0
# FASE2_SIMULACION$PAGO_F2_HITO3[FASE2_SIMULACION$ESTADO.ACTUAL.F2=="Suspendido"]<-0
# FASE2_SIMULACION$PAGO_F2_HITO4[FASE2_SIMULACION$ESTADO.ACTUAL.F2=="Suspendido"]<-0
# FASE2_SIMULACION$PAGO_F2_HITO5[FASE2_SIMULACION$ESTADO.ACTUAL.F2=="Suspendido"]<-0
FASE2_SIMULACION$CORRIDA<-paste("Corrida",i)
FASE2_SIMULACION<-FASE2_SIMULACION[c("ACUERDO.DE.OBRA","INSTITUCIÓN.EDUCATIVA","DEPARTAMENTO","CIUDAD","FIN_LICENCIA_F1","VALOR.INICIAL.F1","FECHA_FIN_HITO1","PAGO_F2_HITO1","FECHA_FIN_HITO2","PAGO_F2_HITO2","FECHA_FIN_HITO3","PAGO_F2_HITO3","FECHA_FIN_HITO4","PAGO_F2_HITO4","FECHA_FIN_HITO5","PAGO_F2_HITO5", "CORRIDA")]
FASE2_TERMINADO<-rbind(FASE2_TERMINADO,FASE2_SIMULACION)
}
DATOS_SIMULACION<-FASE2_TERMINADO %>% gather(VALOR,FECHA_PAGO, c(FIN_LICENCIA_F1,FECHA_FIN_HITO1,FECHA_FIN_HITO2,FECHA_FIN_HITO3,FECHA_FIN_HITO4,FECHA_FIN_HITO5))
DATOS_SIMULACION<-DATOS_SIMULACION %>% gather(PAGO, VALOR_PAGADO, c(VALOR.INICIAL.F1,PAGO_F2_HITO1,PAGO_F2_HITO2,PAGO_F2_HITO3,PAGO_F2_HITO4,PAGO_F2_HITO5))
PRUEBA1<-DATOS_SIMULACION[c(DATOS_SIMULACION$VALOR=="FIN_LICENCIA_F1" & DATOS_SIMULACION$PAGO=="VALOR.INICIAL.F1"),]
PRUEBA2<-DATOS_SIMULACION[c(DATOS_SIMULACION$VALOR=="FECHA_FIN_HITO1" & DATOS_SIMULACION$PAGO=="PAGO_F2_HITO1"),]
PRUEBA3<-DATOS_SIMULACION[c(DATOS_SIMULACION$VALOR=="FECHA_FIN_HITO2" & DATOS_SIMULACION$PAGO=="PAGO_F2_HITO2"),]
PRUEBA4<-DATOS_SIMULACION[c(DATOS_SIMULACION$VALOR=="FECHA_FIN_HITO3" & DATOS_SIMULACION$PAGO=="PAGO_F2_HITO3"),]
PRUEBA5<-DATOS_SIMULACION[c(DATOS_SIMULACION$VALOR=="FECHA_FIN_HITO4" & DATOS_SIMULACION$PAGO=="PAGO_F2_HITO4"),]
PRUEBA6<-DATOS_SIMULACION[c(DATOS_SIMULACION$VALOR=="FECHA_FIN_HITO5" & DATOS_SIMULACION$PAGO=="PAGO_F2_HITO5"),]
DATOS_SIMULACION<-rbind(PRUEBA1,PRUEBA2,PRUEBA3,PRUEBA4,PRUEBA5,PRUEBA6)
DATOS_SIMULACION<-DATOS_SIMULACION[DATOS_SIMULACION$FECHA_PAGO>ymd('2019-01-01'),]
DATOS_SIMULACION<-DATOS_SIMULACION[!is.na(DATOS_SIMULACION$FECHA_PAGO),]
DATOS_SIMULACION$FECHA_NORM<-paste(year(DATOS_SIMULACION$FECHA_PAGO),"-",month(DATOS_SIMULACION$FECHA_PAGO),"-",1)
DATOS_SIMULACION$FECHA_NORM<-as.Date(DATOS_SIMULACION$FECHA_NORM, format="%Y - %m - %d") %m+% months(1)
SIMULACION_FFIE<-aggregate(VALOR_PAGADO~ACUERDO.DE.OBRA+INSTITUCIÓN.EDUCATIVA+CORRIDA+FECHA_NORM+VALOR, data=DATOS_SIMULACION, FUN="sum")
SIMULACION_FFIE$VALOR_PAGADO_PROMEDIO<-SIMULACION_FFIE$VALOR_PAGADO/Corridas
write.csv(DATOS_SIMULACION, file = "SIMULACION_FFIE.csv")
library(DBI)
library(ggplot2)
library(fitdistrplus)
library(ggpubr)
library(rpart)
library(tree)
library(randomForest)
library(rpart.plot)
library(fitdistrplus)
library(stringr)
library(dplyr)
library(triangle)
library(mc2d)
library(PerformanceAnalytics)
library(nortest)
library(lubridate)
library(tidyr)
#MODELO DE SIMULACIÓN -----------------------------
BD <- read.csv("DATOS_GERINT_DEPU.csv", header = TRUE, sep = ",")
Escenarios<-1000
Corridas<- 100
FASE2_TERMINADO<-data.frame(ACUERDO.DE.OBRA=integer(),
INSTITUCIÓN.EDUCATIVA=factor(),
DEPARTAMENTO=factor(),
CIUDAD=factor(),
CORRIDA=character(),
FIN_LICENCIA_F1=as.Date(character()),
VALOR.INICIAL.F1=numeric(),
FECHA_FIN_HITO1=as.Date(character()),
PAGO_F2_HITO1=numeric(),
FECHA_FIN_HITO2=as.Date(character()),
PAGO_F2_HITO2=numeric(),
FECHA_FIN_HITO3=as.Date(character()),
PAGO_F2_HITO3=numeric(),
FECHA_FIN_HITO4=as.Date(character()),
PAGO_F2_HITO4=numeric(),
FECHA_FIN_HITO5=as.Date(character()),
PAGO_F2_HITO5=numeric())
for (i in 1:Corridas) {
set.seed(i)
#SIMULACIÓN DE TERMINACIÓN FASE 1
PROYECTOS_FASE1<-as.data.frame(DATOS[DATOS$ESTADO.ACTUAL.F1!="Terminado",])
PROYECTOS_FASE1<-as.data.frame(PROYECTOS_FASE1[!is.na(PROYECTOS_FASE1$ACUERDO.DE.OBRA),])
PROYECTOS_FASE1<-as.data.frame(PROYECTOS_FASE1[PROYECTOS_FASE1$AVANCE.FASE.1>0,])
PROYECTOS_FASE1<-as.data.frame(PROYECTOS_FASE1[PROYECTOS_FASE1$AVANCE.FASE.1<1,])
PROYECTOS_FASE1$DIAS_FALTANTES<-(PROYECTOS_FASE1$PLAZO.FASE.1*(1-PROYECTOS_FASE1$AVANCE.FASE.1))*30
PROYECTOS_FASE1$INTERVALO=interval(ymd(PROYECTOS_FASE1$FECHA.INICIO.F1),ymd(Sys.Date()))
PROYECTOS_FASE1$P<-(PROYECTOS_FASE1$INTERVALO %/% months(1)/PROYECTOS_FASE1$PLAZO.FASE.1)
PROYECTOS_FASE1$INVERSA<-pnorm(PROYECTOS_FASE1$P,mean = 4.2091667, sd = 0.8483226)
PROYECTOS_FASE1$BETA<-runif(nrow(PROYECTOS_FASE1),min = PROYECTOS_FASE1$INVERSA, max=1)
PROYECTOS_FASE1$PORC_FASE1<-qnorm(PROYECTOS_FASE1$BETA,mean = 4.2091667, sd = 0.8483226)
PROYECTOS_FASE1$DIAS_SIMULADOS<-PROYECTOS_FASE1$PORC_FASE1*PROYECTOS_FASE1$DIAS_FALTANTES
PROYECTOS_FASE1$FIN_FASE1<-ymd(Sys.Date()) + (PROYECTOS_FASE1$DIAS_SIMULADOS)
PROYECTOS_FASE1$RND_LICENCIA<-runif(nrow(PROYECTOS_FASE1))
PROYECTOS_FASE1$DIAS_LICENCIA<-qweibull(PROYECTOS_FASE1$RND_LICENCIA,shape = 1.278237, scale = 110.013093)-176
PROYECTOS_FASE1$DIAS_LICENCIA[PROYECTOS_FASE1$DIAS_LICENCIA<0]<-0
PROYECTOS_FASE1$FIN_LICENCIA_F1<-ymd(PROYECTOS_FASE1$FIN_FASE1) + (PROYECTOS_FASE1$DIAS_LICENCIA)
#SIMULACIÓN DE PEDIDO DE LICENCIA FASE 1
FASE1_TERMINADO<-as.data.frame(DATOS[DATOS$ESTADO.ACTUAL.F1!="Terminado",])
FASE1_TERMINADO<-as.data.frame(FASE1_TERMINADO[!is.na(FASE1_TERMINADO$ACUERDO.DE.OBRA),])
FASE1_TERMINADO<-as.data.frame(FASE1_TERMINADO[FASE1_TERMINADO$AVANCE.FASE.1==1,])
FASE1_TERMINADO$DIAS_FALTANTES<-0
FASE1_TERMINADO$INTERVALO<-interval(ymd(FASE1_TERMINADO$FECHA.INICIO.F1),ymd(Sys.Date()))
FASE1_TERMINADO$P<-(FASE1_TERMINADO$INTERVALO %/% months(1)/FASE1_TERMINADO$PLAZO.FASE.1)
FASE1_TERMINADO$INVERSA<-pnorm(FASE1_TERMINADO$P,mean = 4.2091667, sd = 0.8483226)
FASE1_TERMINADO$BETA<-0
FASE1_TERMINADO$PORC_FASE1<-0
FASE1_TERMINADO$DIAS_SIMULADOS<-0
FASE1_TERMINADO$FIN_FASE1<-FASE1_TERMINADO$FECHA.FIN.F1
FASE1_TERMINADO$RND_LICENCIA<-runif(nrow(FASE1_TERMINADO))
FASE1_TERMINADO$DIAS_LICENCIA<-qweibull(FASE1_TERMINADO$RND_LICENCIA,shape = 1.278237, scale = 110.013093)-176
FASE1_TERMINADO$DIAS_LICENCIA[FASE1_TERMINADO$DIAS_LICENCIA<0]<-0
FASE1_TERMINADO$FIN_LICENCIA_F1<-ymd(Sys.Date()) + (FASE1_TERMINADO$DIAS_LICENCIA)
#SIMULACION DE TERMINACIÓN FASE 2
PROYECTOS_FASE2<-as.data.frame(DATOS[DATOS$ESTADO.ACTUAL.F1=="Terminado",])
PROYECTOS_FASE2$FIN_LICENCIA_F1<-PROYECTOS_FASE2$FECHA.FIN.F1
PROMEDIOS_HITOS<-(PROYECTOS_FASE2[c("PLAZO.ETAPA.1.F2","PLAZO.ETAPA.2.F2","PLAZO.ETAPA.3.F2","PLAZO.ETAPA.4.F2","PLAZO.ETAPA.5.F2")])
PROMEDIOS_HITOS<-PROMEDIOS_HITOS[!is.na(PROMEDIOS_HITOS$PLAZO.ETAPA.1.F2),]
PROMEDIOS_HITOS$MAX<-apply(PROMEDIOS_HITOS,1, max)
PROMEDIOS_HITOS<-PROMEDIOS_HITOS/PROMEDIOS_HITOS$MAX
HITO1<-0
PROMEDIO<-as.data.frame(HITO1)
PROMEDIO$HITO1<-mean(PROMEDIOS_HITOS$PLAZO.ETAPA.1.F2, na.rm = T)
PROMEDIO$HITO2<-mean(PROMEDIOS_HITOS$PLAZO.ETAPA.2.F2, na.rm = T)
PROMEDIO$HITO3<-mean(PROMEDIOS_HITOS$PLAZO.ETAPA.3.F2, na.rm = T)
PROMEDIO$HITO4<-mean(PROMEDIOS_HITOS$PLAZO.ETAPA.4.F2, na.rm = T)
PROMEDIO$HITO5<-mean(PROMEDIOS_HITOS$PLAZO.ETAPA.5.F2, na.rm = T)
PROYECTOS_LICENCIA<-rbind(PROYECTOS_FASE1,FASE1_TERMINADO)
PROYECTOS_SIN_PLAZO<-PROYECTOS_FASE2[PROYECTOS_FASE2$PLAZO.ETAPA.1.F2==0,]
PROYECTOS_SIN_PLAZO<-PROYECTOS_SIN_PLAZO[!is.na(PROYECTOS_SIN_PLAZO$PLAZO.ETAPA.1.F2),]
PROYECTOS_LICENCIA<-subset(PROYECTOS_LICENCIA,select = -c(DIAS_FALTANTES, INTERVALO,P,INVERSA, BETA,PORC_FASE1, DIAS_SIMULADOS, FIN_FASE1, RND_LICENCIA, DIAS_LICENCIA))
PROYECTOS_LICENCIA_FASE1<-rbind(PROYECTOS_LICENCIA,PROYECTOS_SIN_PLAZO)
#PROYECTOS_FASE1_TERMINADOS<-subset(PROYECTOS_LICENCIA_FASE1,select = -c(DIAS_FALTANTES, INTERVALO,P,INVERSA, BETA,PORC_FASE1, DIAS_SIMULADOS, FIN_FASE1, RND_LICENCIA, DIAS_LICENCIA))
PROYECTOS_FASE1_TERMINADOS<-PROYECTOS_LICENCIA_FASE1
PROYECTOS_FASE1_TERMINADOS$PLAZO.ETAPA.1.F2<-PROYECTOS_FASE1_TERMINADOS$PLAZO.FASE.OBRA..F2.*PROMEDIO$HITO1*30
PROYECTOS_FASE1_TERMINADOS$PLAZO.ETAPA.2.F2<-PROYECTOS_FASE1_TERMINADOS$PLAZO.FASE.OBRA..F2.*PROMEDIO$HITO2*30
PROYECTOS_FASE1_TERMINADOS$PLAZO.ETAPA.3.F2<-PROYECTOS_FASE1_TERMINADOS$PLAZO.FASE.OBRA..F2.*PROMEDIO$HITO3*30
PROYECTOS_FASE1_TERMINADOS$PLAZO.ETAPA.4.F2<-PROYECTOS_FASE1_TERMINADOS$PLAZO.FASE.OBRA..F2.*PROMEDIO$HITO4*30
PROYECTOS_FASE1_TERMINADOS$PLAZO.ETAPA.5.F2<-PROYECTOS_FASE1_TERMINADOS$PLAZO.FASE.OBRA..F2.*PROMEDIO$HITO5*30
PROYECTOS_FASE2<-PROYECTOS_FASE2[PROYECTOS_FASE2$PLAZO.ETAPA.1.F2!=0,]
FASE2_SIMULACION<-rbind(PROYECTOS_FASE2, PROYECTOS_FASE1_TERMINADOS)
FASE2_SIMULACION$PAGO_F2_HITO1<-FASE2_SIMULACION$PAGO.ETAPA.1.F2*0.8
FASE2_SIMULACION$PAGO_F2_HITO2<-FASE2_SIMULACION$PAGO.ETAPA.2.F2*0.8
FASE2_SIMULACION$PAGO_F2_HITO3<-FASE2_SIMULACION$PAGO.ETAPA.3.F2*0.8
FASE2_SIMULACION$PAGO_F2_HITO4<-FASE2_SIMULACION$PAGO.ETAPA.4.F2*0.8
FASE2_SIMULACION$PAGO_F2_HITO5<-FASE2_SIMULACION$PAGO.ETAPA.5.F2*0.8
# FASE2_SIMULACION$PLAZO.ETAPA.1.F2[is.na(FASE2_SIMULACION$PLAZO.ETAPA.1.F2)]<-0
# FASE2_SIMULACION$PLAZO.ETAPA.2.F2[is.na(FASE2_SIMULACION$PLAZO.ETAPA.2.F2)]<-0
# FASE2_SIMULACION$PLAZO.ETAPA.3.F2[is.na(FASE2_SIMULACION$PLAZO.ETAPA.3.F2)]<-0
# FASE2_SIMULACION$PLAZO.ETAPA.4.F2[is.na(FASE2_SIMULACION$PLAZO.ETAPA.4.F2)]<-0
# FASE2_SIMULACION$PLAZO.ETAPA.5.F2[is.na(FASE2_SIMULACION$PLAZO.ETAPA.5.F2)]<-0
FASE2_SIMULACION$DIAS_FIN_HITO1<-ceiling((1-FASE2_SIMULACION$AVANCE.F2.ETAPA.1)*(1+sample(BD$PORCENTAJE_DURACION,size=nrow(FASE2_SIMULACION),replace=TRUE))*FASE2_SIMULACION$PLAZO.ETAPA.1.F2)
FASE2_SIMULACION$DIAS_FIN_HITO2<-ceiling((1-FASE2_SIMULACION$AVANCE.F2.ETAPA.2)*(1+sample(BD$PORCENTAJE_DURACION,size=nrow(FASE2_SIMULACION),replace=TRUE))*FASE2_SIMULACION$PLAZO.ETAPA.2.F2)
FASE2_SIMULACION$DIAS_FIN_HITO3<-ceiling((1-FASE2_SIMULACION$AVANCE.F2.ETAPA.3)*(1+sample(BD$PORCENTAJE_DURACION,size=nrow(FASE2_SIMULACION),replace=TRUE))*FASE2_SIMULACION$PLAZO.ETAPA.3.F2)
FASE2_SIMULACION$DIAS_FIN_HITO4<-ceiling((1-FASE2_SIMULACION$AVANCE.F2.ETAPA.4)*(1+sample(BD$PORCENTAJE_DURACION,size=nrow(FASE2_SIMULACION),replace=TRUE))*FASE2_SIMULACION$PLAZO.ETAPA.4.F2)
FASE2_SIMULACION$DIAS_FIN_HITO5<-ceiling((1-FASE2_SIMULACION$AVANCE.F2.ETAPA.5)*(1+sample(BD$PORCENTAJE_DURACION,size=nrow(FASE2_SIMULACION),replace=TRUE))*FASE2_SIMULACION$PLAZO.ETAPA.5.F2)
FASE2_SIMULACION$FIN_LICENCIA_F1[FASE2_SIMULACION$FIN_LICENCIA_F1<Sys.Date()]<-ymd(Sys.Date())
FASE2_SIMULACION$FECHA_FIN_HITO1<-FASE2_SIMULACION$FIN_LICENCIA_F1+ FASE2_SIMULACION$DIAS_FIN_HITO1
FASE2_SIMULACION$FECHA_FIN_HITO2<-FASE2_SIMULACION$FECHA_FIN_HITO1+ FASE2_SIMULACION$DIAS_FIN_HITO2
FASE2_SIMULACION$FECHA_FIN_HITO3<-FASE2_SIMULACION$FECHA_FIN_HITO2+ FASE2_SIMULACION$DIAS_FIN_HITO3
FASE2_SIMULACION$FECHA_FIN_HITO4<-FASE2_SIMULACION$FECHA_FIN_HITO3+ FASE2_SIMULACION$DIAS_FIN_HITO4
FASE2_SIMULACION$FECHA_FIN_HITO5<-FASE2_SIMULACION$FECHA_FIN_HITO4+ FASE2_SIMULACION$DIAS_FIN_HITO5
FASE2_SIMULACION$VALOR.INICIAL.F1[FASE2_SIMULACION$ESTADO.ACTUAL.F1=="Terminado"]<-0
FASE2_SIMULACION$PAGO_F2_HITO1[FASE2_SIMULACION$AVANCE.F2.ETAPA.1==1]<-0
FASE2_SIMULACION$PAGO_F2_HITO2[FASE2_SIMULACION$AVANCE.F2.ETAPA.2==1]<-0
FASE2_SIMULACION$PAGO_F2_HITO3[FASE2_SIMULACION$AVANCE.F2.ETAPA.3==1]<-0
FASE2_SIMULACION$PAGO_F2_HITO4[FASE2_SIMULACION$AVANCE.F2.ETAPA.4==1]<-0
FASE2_SIMULACION$PAGO_F2_HITO5[FASE2_SIMULACION$AVANCE.F2.ETAPA.5==1]<-0
# FASE2_SIMULACION$PAGO_F2_HITO1[FASE2_SIMULACION$ESTADO.ACTUAL.F2=="Abandonado"]<-0
# FASE2_SIMULACION$PAGO_F2_HITO2[FASE2_SIMULACION$ESTADO.ACTUAL.F2=="Abandonado"]<-0
# FASE2_SIMULACION$PAGO_F2_HITO3[FASE2_SIMULACION$ESTADO.ACTUAL.F2=="Abandonado"]<-0
# FASE2_SIMULACION$PAGO_F2_HITO4[FASE2_SIMULACION$ESTADO.ACTUAL.F2=="Abandonado"]<-0
# FASE2_SIMULACION$PAGO_F2_HITO5[FASE2_SIMULACION$ESTADO.ACTUAL.F2=="Abandonado"]<-0
# FASE2_SIMULACION$PAGO_F2_HITO1[FASE2_SIMULACION$ESTADO.ACTUAL.F2=="Suspendido"]<-0
# FASE2_SIMULACION$PAGO_F2_HITO2[FASE2_SIMULACION$ESTADO.ACTUAL.F2=="Suspendido"]<-0
# FASE2_SIMULACION$PAGO_F2_HITO3[FASE2_SIMULACION$ESTADO.ACTUAL.F2=="Suspendido"]<-0
# FASE2_SIMULACION$PAGO_F2_HITO4[FASE2_SIMULACION$ESTADO.ACTUAL.F2=="Suspendido"]<-0
# FASE2_SIMULACION$PAGO_F2_HITO5[FASE2_SIMULACION$ESTADO.ACTUAL.F2=="Suspendido"]<-0
FASE2_SIMULACION$CORRIDA<-paste("Corrida",i)
FASE2_SIMULACION<-FASE2_SIMULACION[c("ACUERDO.DE.OBRA","INSTITUCIÓN.EDUCATIVA","DEPARTAMENTO","CIUDAD","FIN_LICENCIA_F1","VALOR.INICIAL.F1","FECHA_FIN_HITO1","PAGO_F2_HITO1","FECHA_FIN_HITO2","PAGO_F2_HITO2","FECHA_FIN_HITO3","PAGO_F2_HITO3","FECHA_FIN_HITO4","PAGO_F2_HITO4","FECHA_FIN_HITO5","PAGO_F2_HITO5", "CORRIDA")]
FASE2_TERMINADO<-rbind(FASE2_TERMINADO,FASE2_SIMULACION)
}
Corridas<- 1000
FASE2_TERMINADO<-data.frame(ACUERDO.DE.OBRA=integer(),
INSTITUCIÓN.EDUCATIVA=factor(),
DEPARTAMENTO=factor(),
CIUDAD=factor(),
CORRIDA=character(),
FIN_LICENCIA_F1=as.Date(character()),
VALOR.INICIAL.F1=numeric(),
FECHA_FIN_HITO1=as.Date(character()),
PAGO_F2_HITO1=numeric(),
FECHA_FIN_HITO2=as.Date(character()),
PAGO_F2_HITO2=numeric(),
FECHA_FIN_HITO3=as.Date(character()),
PAGO_F2_HITO3=numeric(),
FECHA_FIN_HITO4=as.Date(character()),
PAGO_F2_HITO4=numeric(),
FECHA_FIN_HITO5=as.Date(character()),
PAGO_F2_HITO5=numeric())
for (i in 1:Corridas) {
set.seed(i)
#SIMULACIÓN DE TERMINACIÓN FASE 1
PROYECTOS_FASE1<-as.data.frame(DATOS[DATOS$ESTADO.ACTUAL.F1!="Terminado",])
PROYECTOS_FASE1<-as.data.frame(PROYECTOS_FASE1[!is.na(PROYECTOS_FASE1$ACUERDO.DE.OBRA),])
PROYECTOS_FASE1<-as.data.frame(PROYECTOS_FASE1[PROYECTOS_FASE1$AVANCE.FASE.1>0,])
PROYECTOS_FASE1<-as.data.frame(PROYECTOS_FASE1[PROYECTOS_FASE1$AVANCE.FASE.1<1,])
PROYECTOS_FASE1$DIAS_FALTANTES<-(PROYECTOS_FASE1$PLAZO.FASE.1*(1-PROYECTOS_FASE1$AVANCE.FASE.1))*30
PROYECTOS_FASE1$INTERVALO=interval(ymd(PROYECTOS_FASE1$FECHA.INICIO.F1),ymd(Sys.Date()))
PROYECTOS_FASE1$P<-(PROYECTOS_FASE1$INTERVALO %/% months(1)/PROYECTOS_FASE1$PLAZO.FASE.1)
PROYECTOS_FASE1$INVERSA<-pnorm(PROYECTOS_FASE1$P,mean = 4.2091667, sd = 0.8483226)
PROYECTOS_FASE1$BETA<-runif(nrow(PROYECTOS_FASE1),min = PROYECTOS_FASE1$INVERSA, max=1)
PROYECTOS_FASE1$PORC_FASE1<-qnorm(PROYECTOS_FASE1$BETA,mean = 4.2091667, sd = 0.8483226)
PROYECTOS_FASE1$DIAS_SIMULADOS<-PROYECTOS_FASE1$PORC_FASE1*PROYECTOS_FASE1$DIAS_FALTANTES
PROYECTOS_FASE1$FIN_FASE1<-ymd(Sys.Date()) + (PROYECTOS_FASE1$DIAS_SIMULADOS)
PROYECTOS_FASE1$RND_LICENCIA<-runif(nrow(PROYECTOS_FASE1))
PROYECTOS_FASE1$DIAS_LICENCIA<-qweibull(PROYECTOS_FASE1$RND_LICENCIA,shape = 1.278237, scale = 110.013093)-176
PROYECTOS_FASE1$DIAS_LICENCIA[PROYECTOS_FASE1$DIAS_LICENCIA<0]<-0
PROYECTOS_FASE1$FIN_LICENCIA_F1<-ymd(PROYECTOS_FASE1$FIN_FASE1) + (PROYECTOS_FASE1$DIAS_LICENCIA)
#SIMULACIÓN DE PEDIDO DE LICENCIA FASE 1
FASE1_TERMINADO<-as.data.frame(DATOS[DATOS$ESTADO.ACTUAL.F1!="Terminado",])
FASE1_TERMINADO<-as.data.frame(FASE1_TERMINADO[!is.na(FASE1_TERMINADO$ACUERDO.DE.OBRA),])
FASE1_TERMINADO<-as.data.frame(FASE1_TERMINADO[FASE1_TERMINADO$AVANCE.FASE.1==1,])
FASE1_TERMINADO$DIAS_FALTANTES<-0
FASE1_TERMINADO$INTERVALO<-interval(ymd(FASE1_TERMINADO$FECHA.INICIO.F1),ymd(Sys.Date()))
FASE1_TERMINADO$P<-(FASE1_TERMINADO$INTERVALO %/% months(1)/FASE1_TERMINADO$PLAZO.FASE.1)
FASE1_TERMINADO$INVERSA<-pnorm(FASE1_TERMINADO$P,mean = 4.2091667, sd = 0.8483226)
FASE1_TERMINADO$BETA<-0
FASE1_TERMINADO$PORC_FASE1<-0
FASE1_TERMINADO$DIAS_SIMULADOS<-0
FASE1_TERMINADO$FIN_FASE1<-FASE1_TERMINADO$FECHA.FIN.F1
FASE1_TERMINADO$RND_LICENCIA<-runif(nrow(FASE1_TERMINADO))
FASE1_TERMINADO$DIAS_LICENCIA<-qweibull(FASE1_TERMINADO$RND_LICENCIA,shape = 1.278237, scale = 110.013093)-176
FASE1_TERMINADO$DIAS_LICENCIA[FASE1_TERMINADO$DIAS_LICENCIA<0]<-0
FASE1_TERMINADO$FIN_LICENCIA_F1<-ymd(Sys.Date()) + (FASE1_TERMINADO$DIAS_LICENCIA)
#SIMULACION DE TERMINACIÓN FASE 2
PROYECTOS_FASE2<-as.data.frame(DATOS[DATOS$ESTADO.ACTUAL.F1=="Terminado",])
PROYECTOS_FASE2$FIN_LICENCIA_F1<-PROYECTOS_FASE2$FECHA.FIN.F1
PROMEDIOS_HITOS<-(PROYECTOS_FASE2[c("PLAZO.ETAPA.1.F2","PLAZO.ETAPA.2.F2","PLAZO.ETAPA.3.F2","PLAZO.ETAPA.4.F2","PLAZO.ETAPA.5.F2")])
PROMEDIOS_HITOS<-PROMEDIOS_HITOS[!is.na(PROMEDIOS_HITOS$PLAZO.ETAPA.1.F2),]
PROMEDIOS_HITOS$MAX<-apply(PROMEDIOS_HITOS,1, max)
PROMEDIOS_HITOS<-PROMEDIOS_HITOS/PROMEDIOS_HITOS$MAX
HITO1<-0
PROMEDIO<-as.data.frame(HITO1)
PROMEDIO$HITO1<-mean(PROMEDIOS_HITOS$PLAZO.ETAPA.1.F2, na.rm = T)
PROMEDIO$HITO2<-mean(PROMEDIOS_HITOS$PLAZO.ETAPA.2.F2, na.rm = T)
PROMEDIO$HITO3<-mean(PROMEDIOS_HITOS$PLAZO.ETAPA.3.F2, na.rm = T)
PROMEDIO$HITO4<-mean(PROMEDIOS_HITOS$PLAZO.ETAPA.4.F2, na.rm = T)
PROMEDIO$HITO5<-mean(PROMEDIOS_HITOS$PLAZO.ETAPA.5.F2, na.rm = T)
PROYECTOS_LICENCIA<-rbind(PROYECTOS_FASE1,FASE1_TERMINADO)
PROYECTOS_SIN_PLAZO<-PROYECTOS_FASE2[PROYECTOS_FASE2$PLAZO.ETAPA.1.F2==0,]
PROYECTOS_SIN_PLAZO<-PROYECTOS_SIN_PLAZO[!is.na(PROYECTOS_SIN_PLAZO$PLAZO.ETAPA.1.F2),]
PROYECTOS_LICENCIA<-subset(PROYECTOS_LICENCIA,select = -c(DIAS_FALTANTES, INTERVALO,P,INVERSA, BETA,PORC_FASE1, DIAS_SIMULADOS, FIN_FASE1, RND_LICENCIA, DIAS_LICENCIA))
PROYECTOS_LICENCIA_FASE1<-rbind(PROYECTOS_LICENCIA,PROYECTOS_SIN_PLAZO)
#PROYECTOS_FASE1_TERMINADOS<-subset(PROYECTOS_LICENCIA_FASE1,select = -c(DIAS_FALTANTES, INTERVALO,P,INVERSA, BETA,PORC_FASE1, DIAS_SIMULADOS, FIN_FASE1, RND_LICENCIA, DIAS_LICENCIA))
PROYECTOS_FASE1_TERMINADOS<-PROYECTOS_LICENCIA_FASE1
PROYECTOS_FASE1_TERMINADOS$PLAZO.ETAPA.1.F2<-PROYECTOS_FASE1_TERMINADOS$PLAZO.FASE.OBRA..F2.*PROMEDIO$HITO1*30
PROYECTOS_FASE1_TERMINADOS$PLAZO.ETAPA.2.F2<-PROYECTOS_FASE1_TERMINADOS$PLAZO.FASE.OBRA..F2.*PROMEDIO$HITO2*30
PROYECTOS_FASE1_TERMINADOS$PLAZO.ETAPA.3.F2<-PROYECTOS_FASE1_TERMINADOS$PLAZO.FASE.OBRA..F2.*PROMEDIO$HITO3*30
PROYECTOS_FASE1_TERMINADOS$PLAZO.ETAPA.4.F2<-PROYECTOS_FASE1_TERMINADOS$PLAZO.FASE.OBRA..F2.*PROMEDIO$HITO4*30
PROYECTOS_FASE1_TERMINADOS$PLAZO.ETAPA.5.F2<-PROYECTOS_FASE1_TERMINADOS$PLAZO.FASE.OBRA..F2.*PROMEDIO$HITO5*30
PROYECTOS_FASE2<-PROYECTOS_FASE2[PROYECTOS_FASE2$PLAZO.ETAPA.1.F2!=0,]
FASE2_SIMULACION<-rbind(PROYECTOS_FASE2, PROYECTOS_FASE1_TERMINADOS)
FASE2_SIMULACION$PAGO_F2_HITO1<-FASE2_SIMULACION$PAGO.ETAPA.1.F2*0.8
FASE2_SIMULACION$PAGO_F2_HITO2<-FASE2_SIMULACION$PAGO.ETAPA.2.F2*0.8
FASE2_SIMULACION$PAGO_F2_HITO3<-FASE2_SIMULACION$PAGO.ETAPA.3.F2*0.8
FASE2_SIMULACION$PAGO_F2_HITO4<-FASE2_SIMULACION$PAGO.ETAPA.4.F2*0.8
FASE2_SIMULACION$PAGO_F2_HITO5<-FASE2_SIMULACION$PAGO.ETAPA.5.F2*0.8
# FASE2_SIMULACION$PLAZO.ETAPA.1.F2[is.na(FASE2_SIMULACION$PLAZO.ETAPA.1.F2)]<-0
# FASE2_SIMULACION$PLAZO.ETAPA.2.F2[is.na(FASE2_SIMULACION$PLAZO.ETAPA.2.F2)]<-0
# FASE2_SIMULACION$PLAZO.ETAPA.3.F2[is.na(FASE2_SIMULACION$PLAZO.ETAPA.3.F2)]<-0
# FASE2_SIMULACION$PLAZO.ETAPA.4.F2[is.na(FASE2_SIMULACION$PLAZO.ETAPA.4.F2)]<-0
# FASE2_SIMULACION$PLAZO.ETAPA.5.F2[is.na(FASE2_SIMULACION$PLAZO.ETAPA.5.F2)]<-0
FASE2_SIMULACION$DIAS_FIN_HITO1<-ceiling((1-FASE2_SIMULACION$AVANCE.F2.ETAPA.1)*(1+sample(BD$PORCENTAJE_DURACION,size=nrow(FASE2_SIMULACION),replace=TRUE))*FASE2_SIMULACION$PLAZO.ETAPA.1.F2)
FASE2_SIMULACION$DIAS_FIN_HITO2<-ceiling((1-FASE2_SIMULACION$AVANCE.F2.ETAPA.2)*(1+sample(BD$PORCENTAJE_DURACION,size=nrow(FASE2_SIMULACION),replace=TRUE))*FASE2_SIMULACION$PLAZO.ETAPA.2.F2)
FASE2_SIMULACION$DIAS_FIN_HITO3<-ceiling((1-FASE2_SIMULACION$AVANCE.F2.ETAPA.3)*(1+sample(BD$PORCENTAJE_DURACION,size=nrow(FASE2_SIMULACION),replace=TRUE))*FASE2_SIMULACION$PLAZO.ETAPA.3.F2)
FASE2_SIMULACION$DIAS_FIN_HITO4<-ceiling((1-FASE2_SIMULACION$AVANCE.F2.ETAPA.4)*(1+sample(BD$PORCENTAJE_DURACION,size=nrow(FASE2_SIMULACION),replace=TRUE))*FASE2_SIMULACION$PLAZO.ETAPA.4.F2)
FASE2_SIMULACION$DIAS_FIN_HITO5<-ceiling((1-FASE2_SIMULACION$AVANCE.F2.ETAPA.5)*(1+sample(BD$PORCENTAJE_DURACION,size=nrow(FASE2_SIMULACION),replace=TRUE))*FASE2_SIMULACION$PLAZO.ETAPA.5.F2)
FASE2_SIMULACION$FIN_LICENCIA_F1[FASE2_SIMULACION$FIN_LICENCIA_F1<Sys.Date()]<-ymd(Sys.Date())
FASE2_SIMULACION$FECHA_FIN_HITO1<-FASE2_SIMULACION$FIN_LICENCIA_F1+ FASE2_SIMULACION$DIAS_FIN_HITO1
FASE2_SIMULACION$FECHA_FIN_HITO2<-FASE2_SIMULACION$FECHA_FIN_HITO1+ FASE2_SIMULACION$DIAS_FIN_HITO2
FASE2_SIMULACION$FECHA_FIN_HITO3<-FASE2_SIMULACION$FECHA_FIN_HITO2+ FASE2_SIMULACION$DIAS_FIN_HITO3
FASE2_SIMULACION$FECHA_FIN_HITO4<-FASE2_SIMULACION$FECHA_FIN_HITO3+ FASE2_SIMULACION$DIAS_FIN_HITO4
FASE2_SIMULACION$FECHA_FIN_HITO5<-FASE2_SIMULACION$FECHA_FIN_HITO4+ FASE2_SIMULACION$DIAS_FIN_HITO5
FASE2_SIMULACION$VALOR.INICIAL.F1[FASE2_SIMULACION$ESTADO.ACTUAL.F1=="Terminado"]<-0
FASE2_SIMULACION$PAGO_F2_HITO1[FASE2_SIMULACION$AVANCE.F2.ETAPA.1==1]<-0
FASE2_SIMULACION$PAGO_F2_HITO2[FASE2_SIMULACION$AVANCE.F2.ETAPA.2==1]<-0
FASE2_SIMULACION$PAGO_F2_HITO3[FASE2_SIMULACION$AVANCE.F2.ETAPA.3==1]<-0
FASE2_SIMULACION$PAGO_F2_HITO4[FASE2_SIMULACION$AVANCE.F2.ETAPA.4==1]<-0
FASE2_SIMULACION$PAGO_F2_HITO5[FASE2_SIMULACION$AVANCE.F2.ETAPA.5==1]<-0
# FASE2_SIMULACION$PAGO_F2_HITO1[FASE2_SIMULACION$ESTADO.ACTUAL.F2=="Abandonado"]<-0
# FASE2_SIMULACION$PAGO_F2_HITO2[FASE2_SIMULACION$ESTADO.ACTUAL.F2=="Abandonado"]<-0
# FASE2_SIMULACION$PAGO_F2_HITO3[FASE2_SIMULACION$ESTADO.ACTUAL.F2=="Abandonado"]<-0
# FASE2_SIMULACION$PAGO_F2_HITO4[FASE2_SIMULACION$ESTADO.ACTUAL.F2=="Abandonado"]<-0
# FASE2_SIMULACION$PAGO_F2_HITO5[FASE2_SIMULACION$ESTADO.ACTUAL.F2=="Abandonado"]<-0
# FASE2_SIMULACION$PAGO_F2_HITO1[FASE2_SIMULACION$ESTADO.ACTUAL.F2=="Suspendido"]<-0
# FASE2_SIMULACION$PAGO_F2_HITO2[FASE2_SIMULACION$ESTADO.ACTUAL.F2=="Suspendido"]<-0
# FASE2_SIMULACION$PAGO_F2_HITO3[FASE2_SIMULACION$ESTADO.ACTUAL.F2=="Suspendido"]<-0
# FASE2_SIMULACION$PAGO_F2_HITO4[FASE2_SIMULACION$ESTADO.ACTUAL.F2=="Suspendido"]<-0
# FASE2_SIMULACION$PAGO_F2_HITO5[FASE2_SIMULACION$ESTADO.ACTUAL.F2=="Suspendido"]<-0
FASE2_SIMULACION$CORRIDA<-paste("Corrida",i)
FASE2_SIMULACION<-FASE2_SIMULACION[c("ACUERDO.DE.OBRA","INSTITUCIÓN.EDUCATIVA","DEPARTAMENTO","CIUDAD","FIN_LICENCIA_F1","VALOR.INICIAL.F1","FECHA_FIN_HITO1","PAGO_F2_HITO1","FECHA_FIN_HITO2","PAGO_F2_HITO2","FECHA_FIN_HITO3","PAGO_F2_HITO3","FECHA_FIN_HITO4","PAGO_F2_HITO4","FECHA_FIN_HITO5","PAGO_F2_HITO5", "CORRIDA")]
FASE2_TERMINADO<-rbind(FASE2_TERMINADO,FASE2_SIMULACION)
}
SIMULACION_FFIE<-aggregate(VALOR_PAGADO~CORRIDA+VALOR+FECHA_NORM, data=DATOS_SIMULACION, FUN="sum")
write.csv(SIMULACION_FFIE, file = "SIMULACION_FFIE.csv")
View(FASE2_TERMINADO)
DATOS_SIMULACION<-FASE2_TERMINADO %>% gather(VALOR,FECHA_PAGO, c(FIN_LICENCIA_F1,FECHA_FIN_HITO1,FECHA_FIN_HITO2,FECHA_FIN_HITO3,FECHA_FIN_HITO4,FECHA_FIN_HITO5))
DATOS_SIMULACION<-DATOS_SIMULACION %>% gather(PAGO, VALOR_PAGADO, c(VALOR.INICIAL.F1,PAGO_F2_HITO1,PAGO_F2_HITO2,PAGO_F2_HITO3,PAGO_F2_HITO4,PAGO_F2_HITO5))
PRUEBA1<-DATOS_SIMULACION[c(DATOS_SIMULACION$VALOR=="FIN_LICENCIA_F1" & DATOS_SIMULACION$PAGO=="VALOR.INICIAL.F1"),]
PRUEBA2<-DATOS_SIMULACION[c(DATOS_SIMULACION$VALOR=="FECHA_FIN_HITO1" & DATOS_SIMULACION$PAGO=="PAGO_F2_HITO1"),]
PRUEBA3<-DATOS_SIMULACION[c(DATOS_SIMULACION$VALOR=="FECHA_FIN_HITO2" & DATOS_SIMULACION$PAGO=="PAGO_F2_HITO2"),]
PRUEBA4<-DATOS_SIMULACION[c(DATOS_SIMULACION$VALOR=="FECHA_FIN_HITO3" & DATOS_SIMULACION$PAGO=="PAGO_F2_HITO3"),]
PRUEBA5<-DATOS_SIMULACION[c(DATOS_SIMULACION$VALOR=="FECHA_FIN_HITO4" & DATOS_SIMULACION$PAGO=="PAGO_F2_HITO4"),]
PRUEBA6<-DATOS_SIMULACION[c(DATOS_SIMULACION$VALOR=="FECHA_FIN_HITO5" & DATOS_SIMULACION$PAGO=="PAGO_F2_HITO5"),]
DATOS_SIMULACION<-rbind(PRUEBA1,PRUEBA2,PRUEBA3,PRUEBA4,PRUEBA5,PRUEBA6)
DATOS_SIMULACION<-DATOS_SIMULACION[DATOS_SIMULACION$FECHA_PAGO>ymd('2019-01-01'),]
DATOS_SIMULACION<-DATOS_SIMULACION[!is.na(DATOS_SIMULACION$FECHA_PAGO),]
DATOS_SIMULACION$FECHA_NORM<-paste(year(DATOS_SIMULACION$FECHA_PAGO),"-",month(DATOS_SIMULACION$FECHA_PAGO),"-",1)
DATOS_SIMULACION$FECHA_NORM<-as.Date(DATOS_SIMULACION$FECHA_NORM, format="%Y - %m - %d") %m+% months(1)
SIMULACION_FFIE<-aggregate(VALOR_PAGADO~CORRIDA+VALOR+FECHA_NORM, data=DATOS_SIMULACION, FUN="sum")
SIMULACION_FFIE$VALOR_PAGADO_PROMEDIO<-SIMULACION_FFIE$VALOR_PAGADO/Corridas
write.csv(SIMULACION_FFIE, file = "SIMULACION_FFIE.csv")
